# FlatFileItemReader

## 파일 기반 배치 처리

- 파일 기반 데이터 처리는 실무에서 여전히 많이 쓰이고 중요한 역할을 한다.
    - ex) CSV, XML, JSON 등

### 파일 처리의 실체

- 파일 처리를 직접 구현한다면?
    - 파일을 열고 닫는 것부터가 힘들다.
    - 대용랑 파일의 경우 OutOfMemoryError가 나기 십상이다
    - try-catch로 점칠된 예외 처리에 스파게티 코드가 되기 쉽다.
    - 멀티스레드 환경이라면 데드락과 레이스 컨디션 확률이 높다.
    - 청크 일부만 쓰다 실패한다면 트랜잭션 롤백은 직접 해야 한다.

### 파일 기반 배치 처리

- 가장 기본적이면서 강력한 도구 두 가지는 다음과 같다.
    - `FlatFileItemReader`
    - `FlatFileItemWriter`

### Flat 파일이란

- CSV 같은 파일을 싱각하면 된다.
    - 단순히 열과 행으로만 구성된 파일
- 플랫 파일의 특징
    - 각 라인이 하나의 데이터 (레코드 개념)
    - 다양한 구분자 지원
        - CSV의 경우 쉼표로 각 필드를 구분한다.
        - TSV의 경우 탭(\t)으로 구분한다.
    - 강력한 호환성과 범용성
        - 거의 모든 시스템에서 읽고 쓸 수 있는 표준이다.

## FlatFileItemReader

- 플랫 파일로부터 데이터를 읽어오는 Spring Batch의 핵심 도구 중 하나
- `read()` 메서드 동작은 크게 두 단계로 이루어진다.
    - 파일에서 한 줄을을 읽기
    - 읽어온 한 줄을 객체로 변환해 리턴

```java
// FlatFileItemReader.doRead()
// ...
String line = readLine();
// ...
return lineMapper.mapLine(line, lineCount); 
```

- 객체 변환 과정에선 `LineMapper`라는 컴포넌트가 핵심을 담당한다.
    - Spring JDBC의 `RowMapper`와 유사

```java
public interface LineMapper<T> {
    T mapLine(String line, int lineNumber) throws Exception;
}
```
