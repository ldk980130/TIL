# ItemProcessor

- `ItemProcessor`에는 고유한 비즈니스 로직이 들어가는 곳이다.
    - 그래서 Spring이 제공하는 별도의 구현체는 거의 없다.

## null 반환을 통한 데이터 필터링

- `ItemProcessor`의 `process()` 메서드가 `null`을 반환하면 해당 `item`은 제외된다.
- 진행 과정
    - 청크 사이즈만큼 `read()` 메서드를 호출해 청크를 생성
    - 청크의 각 item에 대해 `process()` 메서드 호출
    - `process()`에서 `null`이 반환되면 최종 청크에서 제외
    - `ItemWriter`에 전달되는 청크 크기는 초반 청크의 크기보다 작아진다.
- 보통 `null`이 반환되는 경우
    - 유효하지 않은 데이터
    - 처리가 불필요한 데이터
    - 특정 조건에 맞지 않는 데이터

### ValidatingItemProcessor

- Spring Batch에서 제공하는 `null` 반환 방식의 데이터 검증을 수행하는 `ItemProcessor` 구현체
- `ValidatingItemProcessor`를 생성하려면 `Validator` 인터페이스가 필요하다.
    - `org.springframework.batch.item.validator.Validator`

```java
public interface Validator<T> {
    void validate(T value) throws ValidationException;
}

public class CommandValidator implements Validator<Command> {
    @Override
    public void validate(Command command) throws ValidationException {
        // ... 특정 로직에 따라 ValidationException 던지기
    }
}
```

- `T` 제네릭 타입(item의 타입)을 받아 `ValidationException`을 던지도록 구현하면 된다.
    - 이 때 `setFilter(true)`를 설정해야 `ValidationException`이 발생했을 때 `null`이 반환된다.
    - `setFilter(false)`가 되면 예외가 상위로 전달되어 `Step`이 실패한다.

```java
@Bean
public ItemProcessor<Command, Command> commandProcessor() {
    ValidatingItemProcessor<Command> processor = 
        new ValidatingItemProcessor<>(new CommandValidator());
    processor.setFilter(true);  // ValidationException 발생 시 필터링 수행
    return processor;
}
```
