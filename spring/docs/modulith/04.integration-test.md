# 4. Integration Testing Application Modules
https://docs.spring.io/spring-modulith/reference/testing.html

- Spring Modulith를 사용하면 각 애플리케이션 모듈을 단독으로 또는 다른 모듈과 조합하여 부트스트랩하는 통합 테스트를 실행할 수 있다.
- 애플리케이션 모듈 패키지 또는 그 하위 패키지에 JUnit 테스트 클래스를 배치한 뒤 `@ApplicationModuleTest` 애너테이션을 달면 된다.

```kotlin
package example.order

@ApplicationModuleTest
class OrderIntegrationTests {

  // Individual test cases go here
}
```

- `@SpringBootTest`와 유사한 통합 테스트가 실행된다.
    - 그러나 실제로는 테스트가 상주하는 애플리케이션 모듈로 제한된다.
- `org.springframework.modulith=DEBUG`로 설정하면 스프링부트 부트스트랩을 정의하는 방법에 대한 자세한 정보를 알 수 있다.
    - 콘솔 로그에 모듈에 대한 자세한 정보가 표시될 것이다.

```
  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::       (v3.0.0-SNAPSHOT)

… - Bootstrapping @ApplicationModuleTest for example.order in mode STANDALONE (class example.Application)…
… - ======================================================================================================
… - ## example.order ##
… - > Logical name: order
… - > Base package: example.order
… - > Direct module dependencies: none
… - > Spring beans:
… -       + ….OrderManagement
… -       + ….internal.OrderInternal
… - Starting OrderIntegrationTests using Java 17.0.3 …
… - No active profile set, falling back to 1 default profile: "default"
… - Re-configuring auto-configuration and entity scan packages to: example.order.
```

## 부트스트랩 모드

- 애플리케이션 모듈 테스트는 다양한 모드를 제공한다.
    - `STANDALONE` (default) - 현재 모듈만 수행
    - `DIRECT_DEPENDENCIES` - 현재 모듈 그리고 직접적인 의존이 있는 모듈만 수행
    - `ALL_DEPENDENCIES` - 의존 관계가 있는 전체 모듈 트리에 대해 수행

## 효과적인 의존성 다루기

- 애플리케이션 모듈이 부트스트랩되면 해당 모듈의 스프링 빈이 인스턴스화된다.
- 모듈 경계를 넘나드는 빈 참조가 있는 경우 다른 모듈이 테스트 실행에 포함되지 않으면 부트스트랩이 실패한다.
- 다른 모듈까지 범위를 확장할 수도 있지만 일반적으로 대상 빈을 모킹하는 것이 더 나은 옵션이다.
    - ex) `@MockBean` 사용
- 애플리케이션 모듈이 다른 모듈 빈에 너무 많이 의존하는 경우 일반적으로 결합이 높다는 신호
    - 이러한 의존성은 도메인 이벤트를 통해 대체할 수 없는지 검토해봐야 한다.

