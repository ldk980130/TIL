# 10장 클러스터

## 레디스 클러스터와 확장성

### 스케일업 vs 스케일 아웃

- 확장성(scalability)은 운영 중인 시스템에서 증가하는 트래픽에 유연하게 대응할 수 있는 능력을 뜻한다.
- 스케일 업
    - 서버의 하드웨어를 높은 사양으로 업그레이드하는 것
    - 수직 확장
- 스케일 아웃
    - 장비를 추가해 시스템을 확장하는 방식
    - 수평 확장
- 일반적으로 스케일 업이 간단하지만 하드웨어 범위 내에서만 가능하기에 한계가 있다.
- 스케일 아웃은 장비를 추가함에 따라 확장이 가능하지만 분산 처리에 대한 로직이 추가 개발 되어야 한다.

### 레디스에서의 확장성

- 레디스 처리량을 증가시킬 때 스케일 업만으로는 한계가 있다.
- 레디스는 단일 스레드로 동작하기에 CPU를 추가해도 코어를 동시에 활용할 수 없다.
- 데이터를 여러 서버로 분할해 관리하여 처리량을 선형적으로 확장시킬 수 있다.

### 레디스 클러스터의 기능

- 레디스의 클러스터 모드
    - 애플리케이션 아키텍처 변경 없이 레디스 인스턴스 간 수평 확장이 가능
    - 데이터 분산 처리, 복제, 자동 페일오버 기능 또한 사용 가능
- 데이터 샤딩
    - 마스터를 최대 1000개까지 확장시킬 수 있다.
    - 샤딩과 관련된 기능은 레디스 내부에서 자체적으로 관리되기에 프록시 서버 등의 추가 작업은 필요치 않다.
    - 데이터는 키를 이용해 샤딩되며 하나의 키는 하나의 마스터 노드에 매핑된다.
    - 클라이언트가 키가 없는 마스터 노드에 연결하면 키가 할당된 마스터 노드로 리다이렉션한다.
- 고가용성
    - 클러스터는 각각 최소 3대 마스터, 복제본 노드를 갖도록 하는 것이 일반적이다.
    - 하나의 클러스터 구성에 속한 각 노드는 서로를 모니터링한다.
    - 한 마스터 노드에 장애가 발생하면 자동 페일오버가 발생하기에 가용성이 높다.
    - 클러스터 내 노드들은 클러스터 버스라는 독립적 통신을 이용하여 다른 노드와 통신한다.
    - 풀 메쉬 토폴로지 형태
        - 모든 노드가 TCP 연결을 사용해 다른 모든 노드와 연결돼 있다.
        - 클러스터가 정상적인 상태에서는 노드 간 너무 많은 메시지 교환은 일어나지 않기에 오버헤드는 걱정하지 않아도 된다.
