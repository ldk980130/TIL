# 8장 복제
- 가용성은 일반적으로 서비스 안정성을 측정하는 지표다
    - `Availability = Available for Use Time / Total Time`
- 레디스에서 고가용성을 확보하기 위한 기능
    - 복제: 마스터 노드 데이터를 복제 노드로 실시간 복사하는 기능
    - 자동 페일오버: 마스터 노드의 장애를 감지해 클라이언트 연결을 자동으로 복제 노드로 리다이렉션하는 기능

## 레디스에서의 복제 구조

- 복제본 노드를 추가하는 이유
    - 서비스를 안정적으로 운영하기 위해서
    - 대규모 서비스에서 트래픽을 감소시키는 역할 수행
    - 데이터의 백업을 복제본에서 수행하면 백업 작업이 서비스에 미치는 영향을 최소화할 수 있다.
- 레디스는 멀티 마스터 구조를 지원하지 않아 마스터는 복제본이 될 수 없다.
    - MySQL이나 PostgreSQL은 멀티 마스터 복제 구조를 제공
    - 모든 데이터 입력은 마스터 노드에서, 복제본은 데이터를 그대로 받아온다.

### 복제 구조 구성하기

```bash
REPLICAOF <master-ip> <master-port>
```

- 복제본이 될 노드에서 위 커맨드를 입력해 마스터 노드 정보를 입력하면 복제 연결이 시작된다.
    - 마스터 다운 시 연결 설정을 복제본으로 변경하면 서비스를 지속할 수 있다.
- 레디스 복제 그룹에선 항상 하나의 마스터 노드만 존재한다.
    - 레디스 마스터에는 여러 복제본이 연결될 수 있다.
    - 복제본에 새로운 복제본을 추가할 수도 있다.
    - 복제본은 읽기 전용이다.

### 패스워드 설정

- 기본적인 패스워드를 사용해서 데이터를 복제할 때에는 `masterauth` 옵션에 패스워드를 입력해야 한다.
- 레디스에선 `requirepass` 옵션으로 패스워드를 설정할 수 있다.
    - 복제본은 `masterpass` 옵션에 마스터의 `requirepass`에 설정된 패스워드를 입력해야 한다.
- 하나의 복제 그룹에 속한 마스터와 복제 노드는 같은 패스워드로 하는 것이 일반적이다.
