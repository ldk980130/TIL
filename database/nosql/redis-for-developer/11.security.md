# 11장 보안
- 레디스는 관계형 데이터베이스만큼 보안 관리가 필요하다.
    - 캐시로 사용할 경우 캐시에 접근한다는 것은 db에 접근한다는 것과 동일한 효력을 지닌다.
    - pub/sub 혹은 MQ로서 사용하더라도 데이터의 중간 전달자 역할을 하기에 데이터는 더 안전하게 보관되어야 한다.

## 커넥션 제어

### bind

- 레디스 인스턴스는 여러 개의 네트워크 인터페이스를 가질 수 있다.
- bind 설정은 여러 ip 중 어떤 ip를 통해 연결을 받아들일 것인지 지정한다.
- 서버 외부와 연결이 필요한 경우 bind 값을 외부 ip로 명시적으로 설정해야 한다.
    - 특정 IP 외에 연결을 방지하는 보안적 설정을 권장한다.

### 패스워드

- 레디스에서는 패스워드 설정에 두 가지 방법을 사용할 수 있다.
    - 노드에 직접 패스워드를 지정
    - 6.0 버전에 새로 추가된 ACL(Access Control List) 기능 사용
- 이전 버전에선 requirepass를 사용해 레디스 서버에 패스워드를 설정할 수 있다.

```bash
127.0.0.1:6379> CONFIG SET requirepass password
OK
```

### Protected mode

- protected mode는 레디스를 운영 용도로 사용한다면 설정하는 것을 권장한다.
- protected mode=yes
    - 패스워드를 설정하지 않았다면 로컬에서의 연결만 허용한다.
- 즉 패스워드를 사용하지 않을 때는 protected mode를 no로 변경해야 한다.

## 커맨드 제어

- 대부분의 레디스 파라미터는 `CONFIG SET` 커맨드로 재설정할 수 있다.
- 운영자가 커맨드라인으로 인스턴스를 제어하면 편리하지만 보안적으로는 위험할 수 있다.

### 커맨드 이름 변경

- `rename-command`
  - 레디스에서 특정 커맨드를 다른 이름으로 변경하거나 비활성화할 수 있는 설정
  - 커맨드를 커스터마이징하여 보안을 강화하는데 도움이 된다.
  - redis.conf 파일에서 변경 가능하며 실행 중에는 동적으로 변경할 수 없다.
- 센티널을 사용한다면 신경 써야 할 사항이 있다.
  - 센티널이 자체적으로 커맨드를 날려 이스턴스를 제어하는 경우가 있다.
  - 만약 커맨드 이름을 변경했다면 페일오버가 정상적으로 발생하지 않게 된다.
  - 따라서 redis.conf에서 변경한 커맨드는 sentinel.conf에서도 변경해야 한다.

### 커맨드 실행 환경 제어

- 레디스 버전 7부터는 보안 강화를 위해 특정 커맨드를 실행하는 환경을 제어할 수 있게 되었다.
- `enable-protected-configs no`
  - 레디스 기본 경로 설정인 dir 및 백업 파일 경로를 지정하는 dbfile 등 옵션을 CONFIG로 수정하는 것을 차단하는 옵션
- `enable-debug-command no`
  - DEBUG 커맨드를 차단
  - 레디스를 디버깅할 때 사용
- `enable-module command`
  - MODULE 커맨드 수행을 차단
- 위 세 설정 파일은 일반적으로 잘 사용하지 않는 커맨드이기에 공격 가능성을 줄이기 위해 아래와 같은 값으로 변경할 수 있다.
  - `no`: 모든 연결에 대해 명령어 수행을 차단
  - `yes`: 모든 연결에 대해 명령어 수행을 허용
  - `local`: 로컬 연결에 대해서만 명령어 수행이 허용된다.

