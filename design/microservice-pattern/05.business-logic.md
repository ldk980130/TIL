# 5장 비즈니스 로직 설계

## 5.1 비즈니스 로직 구성 패턴

- 주문 서비스는 육각형 아키텍처 구조
    - 중심에 비즈니스 로직이 존재
    - 인바운드/아웃바운드 어댑터가 주변을 감싸고 있다.
- 주문 서비스는 비즈니스 로직과 다음 어댑터로 구성
    - REST API 어댑터: 비즈니스 로직을 호출하는 REST API가 구현된 인바운드 어댑터
    - `OrderCommandHandlers`: 메시지 채널에서 들어온 커맨드 메시지를 받아 비즈니스 로직을 호출하는 인바운드 어댑터
    - DB 어댑터: 비즈니스 로직이 DB 접근을 위해 호출하는 아웃바운드 어댑터
    - 도메인 이벤트 발행 어댑터: 이벤트를 메시지 브로커에 발행하는 아웃바운드 어댑터

### 5.1.1 비즈니스 로직 설계: 트랜잭션 스크립트 패턴

- 트랜잭션 스크립트 패턴
    - 객체 지향 설계를 하지 않고 트랜잭션 스크립트라는 메서드를 작성해 표현 계층의 요청을 처리하는 것
    - 동작이 구현된 클래스와 상태를 보관하는 클래스가 따로 존재
        - 동작 클래스: `OrderServce`, `OrderDao`
        - 상태 클래스: `Order`
    - 복잡한 비즈니스 로직이 아닌 단순한 비즈니스 로직에는 아주 잘 통한다.

### 5.1.2 비즈니스 로직 설계: 도메인 모델 패턴

- 비즈니스 로직이 복잡해지면 도메인 모델 패턴을 응용햔 객체 지향 설계를 하는 것이 좋다.
- 대부분의 클래스가 상태/동작 모두 갖고 있다.
- 도메인 모델 패턴을 적용하면 서비스 메서드가 단순해진다.
    - 서비스 메서드는 DB에서 도메인 객체를 로드하고 메서드 중 하나를 호출
    - 동작/상태를 모두 가진 `Order` 클래스의 상태 값은 프라이빗하기에 메서드를 통한 간접 접근만 가능
- 객체 지향 설계의 장점
    - 설계를 이해/관리하기 쉽다.
    - 테스트하기 쉽다.
    - 잘 알려진 설계 패턴을 응용할 수 있어 확장이 쉽다.

### 5.1.3 도메인 주도 설계 개요

- DDD(Domain-Driven Design)는 복잡한 비즈니스 로직 개발을 위한 방식이다.
    - 하위 도메인과 경계 컨텍스트 개념은 DDD 패턴의 양대 전략
- DDD에서 흔히 쓰이는 빌딩 블록
    - 엔티티: 영속성 신원을 가진 객체. 두 엔티티는 속성 값이 동일해더 엄연히 다른 객체
    - 벨류 객체: 여러 값을 모아 놓은 객체로 속성 값이 동일한 두 벨류 객체는 동일하게 취급 (ex `Money` 클래스)
    - 팩토리: 일반 생성자로 직접 만들기 복잡한 객체 생성 로직이 구현된 객체 또는 메서드
    - 리포지터리: 엔티티를 저장하는 DB 접근 로직을 캡슐화한 객체
    - 서비스: 엔티티, 벨류 객체에 속하지 않은 비즈니스 로직 구현 객체
- 이 외에도 ‘애그리거트’라는 빌딩 블록이 존재한다.
