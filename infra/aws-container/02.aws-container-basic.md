# Chapter 02 컨테이너 설계에 필요한 AWS 기초 지식

## 2-1 AWS가 제공하는 컨테이너 서비스

### 제어 플레인

- 제어 플레인이란 컨테이너를 관리하는 기능을 의미한다.
- AWS가 제공하는 제어 플레인은 2가지가 있다.
    - ECS
    - EKS

### Amazon Elastic Contaner Service (ECS)

- ECS는 완전 관리형 (Fully managed) 컨테이너 오케스트레이터다.
    - 컨테이너를 동작시키는 실행 환경 서비스는 아니다.
    - 쿠버네티스와 달리 AWS가 소유권을 가지고 제공한다.
    - ECS는 다른 AWS 서비스와의 연계성이 매우 좋고 신뢰성이 높다.
- 태스크 (Task)
    - 애플리케이션 실행을 위해선 컨테이너가 필요한데 컨테이너가 동작하는 컴포넌트를 태스크라 한다.
    - 하나 이상의 컨테이너로 구성된 애플리케이션 실행 단위
- 태스크 정의 (Task Definition)
    - 태스크를 만드는 템플릿 정의 (JSON 형식)
    - 컨테이너 이미지, 할당할 자원, Log 출력 장소 등을 지정
    - 태스크 정의에 컨테이너 정의는 여러 개 설정 가능
- 서비스 (Service)
    - 지정한 수만큼의 태스크를 유지하는 스케줄러
    - 서비스를 만들 땐 실행할 태스크 수에 맞춰 로드 밸런서와 태스크를 실행할 네트워크를 지정한다.
    - 태스크가 어떤 이유로 종료 되어도 태스크 정의를 바탕으로 새로운 태스크를 만들어 수를 유지한다.
- 클러스터 (Cluster)
    - ECS 서비스와 태스크를 실행하는 논리 그룹

### Amazon Elastic Kubernetes Service (EKS)

- EKS는 완전 관리형 쿠버네티스 서비스다.
- EKS를 통해 쿠버네티스 제어 플레인 관리를 AWS에게 위임할 수 있다.
- 쿠버네티스 노드를 동작시키는 실행 환경으로 Fargate를 선택할 수 있다.
- EKS는 쿠버네티스 기반이기에 ECS와 달리 AWS 독자적인 용어를 사용하지는 않는다.

### 데이터 플레인

- 컨테이너가 실제로 동작하는 지원 환경을 지정
- AWS가 제공하는 데이터 플레인은 2가지가 있다.
    - EC2
    - Fargate

### Amazon Elastic Compute Cloud (EC2)

- EC2는 AWS에서 가상 머신을 이용할 수 있는 서비스
- ECS나 EKS에서 EC2를 컨테이너 호스트로 사용할 수 있다.
    - 호스트를 운영하는 비용이 높아진다.
    - 서버가 제대로 동작하는지에 대한 모니터링과 자원 관리를 직접 해야 하기 때문
    - 대신 유연성을 요하는 설계에서 필요한 경우가 있다.

### AWS Fargate

- Fargate는 컨테이너용 서버리스 컴퓨팅 엔진이다.
    - 컨테이너용이기에 Fargate만으로는 이용할 수 없다.
- Fargate 장점
    - 호스트를 관리하지 않아도 된다.
    - Fargate 컨테이너 실행 환경은 AWS에서 언제나 최신 상태를 유지해준다.
- Fargate 단점
    - EC2를 사용하는 것보다 가격이 비싸다.
    - 커널 관련 매개변수나 OS 자원을 세세하게 튜닝해야 하는 애플리케이션과는 맞지 않는다.
    - 컨테이너 기동 시간이 다소 오래 걸린다.
- 단점에도 불구하고 Fargate를 선택한다면 그 이유
    - Fargate 스케일링은 매우 간단
    - OS 관련된 운영을 하지 않아도 되기에 전담 인력을 확충하지 않아도 된다.
    - 요금이 EC2에 비해선 높지만 TCO 관점에선 압도적으로 유리하다.
        - TCO 비용: 서비스 도입, 유지, 관리에 드는 총 비용
        - EC2 관리 인건비 + EC2 비용 > Fargate 비용
    - 비즈니스에서 부가 가치를 만드는 활동에 주력하는 의미에서 신규 컨테이너 구축 시 Fargate 활용이 가능한지 적극 검토해보기 바란다.

### Amazon Elastic Container Registry (ECR)

- ECR은 완전 관리형 컨테이너 저장소다.
- ECS와의 연계가 쉽기 때문에 새 컨테이너를 만들 때도 ECR의 이미지를 가져올 수 있다.
- ECR을 통해 Dockerfile에서 이미지를 바로 취득할 때 도커 허브를 이용하지 않아도 된다.
- AWS에 시스템을 구축한다면 다른 AWS 서비스와의 연계나 보안을 고려해 ECR을 사용하는 것을 추천한다.
