# 3-5 보안 설계
- AWS에서도 클라우드 보안은 최우선 사항으로 취급된다.
- AWS가 제시하는 공동 책임 모델을 기반으로 ECS/Fargate를 취급하는 데 있어 중요한 설계 포인트를 정리한다.

## 공동 책임 모델의 이해

- AWS가 제공하는 공동 책임 모델을 따르는 보안 설계를 해야 한다.
    - AWS는 ‘보안과 규정 준수는 AWS와 고객의 공동 책임이다’라 명시하고 있음
    - 설비와 하드웨어 기반 시설은 AWS가, 애플리케이션이나 데이터 등의 암호화는 이용자가 그 책임을 진다.
- ECS/Fargate 구성을 사용하는 경우
    - AWS의 책임 - 워커 노드와 관련된 보안 대책 (OS 설정 및 취약점 등)
    - 이용자의 책임 - 애플리케이션과 데이터, 네트워크 설정, ECS 태스크, 컨테이너 등
- 이와 같이 이용할 AWS 공동 책임 모델을 파악하면 어디까지 보안을 해야 할지 알 수 있다.

## 컨테이너 개발 보안 모범 사례

- 컨테이너의 보안 수준을 높이기 위한 모범 사례 및 지침으로 NIST SP800-190이 있다.

### NIST SP800-190

- 컨테이너 워크플로의 구성 요소에 대해 보안상 주의점과 대책을 제공
    - 이미지
    - 레지스트리
    - 오케스트레이터
    - 컨테이너
    - 호스트
- 이 책에서는 이용자가 책임져야 하는 부분을 설명한다.

## 이미지에 대한 보안 대책

### ‘이미지 취약점’에 대한 대책

- 컨테이너를 안전하게 이용하려면 이미지에 어떤 취약점이 있는지 주기적으로 확인/제거하는 것이 중요
    - 이미지에는 애플리케이션 뿐 아니라 라이브러리 등이 포함되어 있다.
    - 라이브러리는 시간이 지남에 따라 버전 취약점이 드러날 수도 있다.
- ECR을 이용한 취약점 스캔
    - ECR에서 푸시된 이미지의 취약점을 스캔하는 기능을 활성화할 수 있다.
    - 이미지 스캔은 추가 비용 없이 이용할 수 있다.
    - ‘푸시 시 스캔’과 ‘수동 스캔’이 존재하는데 ‘푸시 시 스캔’ 활성화를 추천
- Trivy를 이용한 취약점 스캔
    - Teppei Fukuda가 개인적으로 개발했고 AquaSecurity가 이어서 개발하고 있는 OSS
    - 컨테이너 보안 수준을 높이기 위해 반드시 이용해야 하는 도구로 자리매김하고 있다.
    - 기본 이미지에 포함된 OS 패키지 뿐 아니라 애플리케이션 종속성도 스캔 대상이 된다.
    - 실행 방법이 매우 간단하며 CI/CD 파이프라인과도 쉽게 통합 가능하다.
- 지속적인 스캔을 위한 설계
    - 이미지 취약점 대책에서 중요한 것은 자동으로 정기적인 스캔을 실행해야 한다는 것이다.
    - CI/CD에서 취약점을 스캔하는 것도 좋은 방법이지만 CI/CD 파이프라인이 실행되지 않으면 취약점을 확인할 수 없다.
    - CloudWatch Event에서 정기적으로 Lambda를 실행해 수동 스캔을 실행하는 방법도 있다.

### 이미지 설정 문제에 대한 대책

- Dockerfile은 작성 방법이나 개발자 수준에 따라 바람직하지 않은 보안 구성이 될 수도 있다.
    - ex) 애플리케이션이 root 권한으로 실행된다면 시스템 영역에 쓰기나 조작이 가능하게 되어 침해 사고가 발생하면 영향이 더 커진다.
- Dockle
    - 컨테이너 설정 내용을 확인해주는 오픈 소스 소프트웨어
    - 컨테이너 이미지에 대해 CIS(The Center for Internet Security)가 제공하는 모범 사례를 바탕으로 이미지를 확인한다.
    - Dockle을 통해 전체적인 컨테이너 이미지 확인이 가능하고 CI/CD 프로세스에 포함시킬 수도 있다.
