# 4.3 로그(로그 세그먼트)

- 카프카 토픽에 들어오는 메시지는 세그먼트 파일에 저장된다.
    - 메시지 뿐 아니라 메시지 키, 벨류, 오프셋, 메시지 크기 등 메타 정보가 함께 저장된다.
    - 로그 세그먼트 파일을 브로커의 로컬 디스크에 보관된다.
- 로그 세그먼트 파일의 최대 크기는 1GB가 기본값이다.
    - 1GB보다 커지면 기본적으로 롤링 전략을 적용해 기존 파일을 닫고 새 로그 세그먼트를 생성한다.
    - 그럼에도 무한히 파일이 늘어나는 것에 대비해 삭제와 컴팩션 전략을 수립해 둘 필요가 있다.

## 4.3.1 로그 세그먼트 삭제

- 카프카 브로커는 기본 설정으로 로그 세그먼트 삭제 정책을 적용한다.
  - server.properties에서 log.cleanup.policy가 delete로 명시되어야 한다. (기본값임)
- retention.ms
  - 이 옵션의 값보다 보관 기간이 큰 로그 파일을 삭제할 수 있다.
  - 카프카 기본 설정값을 7일이기에 7일 뒤면 모든 세그먼트 파일이 삭제된다.
- retention.byte
  - 이 옵션의 값보다 큰 로그 세그먼트 파일을 삭제할 수 있다.
- 로그 세그먼트 삭제는 기본값으로 5분 주기로 수행된다.
