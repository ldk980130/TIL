# 8.2 주키퍼 의존성이 있는 카프카 롤링 업그레이드
- 카프카 버전이 변경되면 명령어 옵션이 변경되거나 삭제되는 경우가 있으므로 스크립트 또는 코드의 명령어들이 잘 동작하는지 반드시 확인해야 한다.

## 8.2.1 최신 버전의 카프카 다운로드와 설정

### 카프카 새 버전 다운로드

- 카프카 다운로드는 모든 브로커에서 진행해야 한다.
- 새 버전 다운로드 후 /usr/local 경로로 이동하여 `ll` 명령어를 통해 현재 디렉토리 상태를 확인하면 다음과 같다.
    - 여기선 2.1 → 2.6 업그레이드한다고 가정

```bash
lrwxrwxrwx 1 root root 27 1월 01 00:08 kafka -> /usr/local/kafka_2.12-2.1.0
drwxr-xr-x 7 root root 101 1월 01 00:08 kafka_2.12-2.1.0
drwxr-xr-x 8 root root 116 1월 01 00:03 kafka_2.12-2.6.0
```

- 아직 kafka 디렉터리는 kafka_2.12-2.1.0로 링크가 걸려있지만 이후 2.6 버전으로 업그레이드 시 링크만 2.6으로 변경하면 된다.

### 카프카 설정 파일 복사

- 2.1 버전과 2.6 버전의 카프카 설정이 일치해야 하므로 설정 파일 경로를 복사해야 한다.

```bash
sudo cp kafka_2.12-2.1.0/config/server.properties kafka_2.12-2.6.0/config/server/properteis
```

### 버전 업그레이드 준비

- vi 명령어를 이용해 kafka_2.12-2.6.0/config/server/properteis 설정 파일에 다음 두 항목을 추가한다.

```bash
inter.broker.protocol.version=2.1
log.message.format.version=2.1
```

- 이는 2.6 버전 카프카가 실행되어도 다른 2.1 버전 브로커들과의 통신이 가능하게 하는 설정이다.
    - `inter.broker.protocol.version` 브로커 간의 내부 통신을 2.1 버전 기반으로 설정
    - `log.message.format.version` 메시지 포밋을 2.1로 유지
