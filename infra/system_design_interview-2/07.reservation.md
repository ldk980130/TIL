# 7장 호텔 예약 시스템
## 1단계: 문제 이해 및 설계 범위 확정

- 기능 요구사항
    - 호텔 정보 페이지 표시
    - 객실 정보 페이지 표시
    - 객실 예약/취소
        - 대금은 예약 시 지불
        - 객실 가격은 유동적
    - 호텔이나 객실 정보를 추가/삭제/갱신하는 관리자 페이지 지원
    - 초과 예약 지원
        - 일부 고객이 예약을 취소할 것을 예상하여 10% 초과예약이 가능해야 한다.
- 비기능 요구사항
    - 높은 수준의 동시성 지원 (성수기나 대규모 이벤트 고려)
    - 적절한 지연 시간
        - 예약 시 응답 속도가 빠르면 이상적이겠지만 요청 처리에 몇 초 정도 걸리는 것은 괜찮다.
- 계략적 규모 측정
    - 5000개 호텔, 100만 개 객실을 가정
    - 평균적으로 객실의 70%가 사용 중이고 평균 투숙 기간은 3일이라 가정
    - 일일 예약 건수: `백만 * 0.7 / 3 = 233,333`
    - 초당 예약 건수 = `240,000 / 10^5초 =~ 3.`
        - TPS는 그다지 높지 않다.
- QPS 예측
    - 예약 페이지의 사용 흐름에는 세 단계가 존재한다.
        - 호텔/객실 상세 페이지: 사용자가 정보를 확인 (조회)
        - 예약 상세 정보 페이지: 사용자가 날짜, 투숙 인원, 결제 등 상세 정보를 예약 전에 확인 (조회)
        - 객실 예약 페이지: 사용자가 객실을 예약 (트랜잭션 발생)
    - 대략 10% 사용자가 다음 단계로 진행한다고 가정하여 다음 결과를 제시
        - 객실 상세 QPS - 300
        - 예약 상세 QPS - 30
        - 객실 예약 QOS - 3
## 2단계: 개략적 설계안 제시 및 동의 구하기

### API 설계

- 각종 조회 api와 관리자용 호텔/객실 수정 api가 물론 있지만 ‘신규 예약 접수’만 살펴보자
- POST `/v1/reservations`
    - `reservationID`는 이중 예약 방지를 보장하는 멱등 키다.
    - 이중 예약은 같은 날 같은 객실에 예약이 중복으로 이루어지는 것을 말한다.

```json
{
	"startDate": "2021-04-28",
	"endDate": "2021-04-30",
	"hotelID": "245",
	"roomID": "U1234546",
	"reservationID": "13422445"
}
```
